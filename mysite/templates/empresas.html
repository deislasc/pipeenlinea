{%- extends "base.html" -%}
{%- block content -%}
            <div class="panel">
                <div class="botonera">
                    <table border="0px" spacing=0 width="100%" cellpadding="0" cellspacing="0">

                        <tr>
                        <td width="40%" align="center">Criterio</td>
                        <td ></td>
                        <td width="40%" align="center">Valor</td>
                        </tr>
                        <tr>
                            <td width="33%" align="center">
                                <select class="roundInput" id="filtroCriterio" name="filtroCriterio" onchange="limpiarFiltroSolicitudes();">
                                    {%- for campo in listaCamposFiltro|sort(attribute='label') -%}
                                        {%- if (campo.filterOption=="true" and campo.editRenderable=="true")-%}
                                            <option value="{{campo.value}}">{{campo.label}}</option>
                                        {%-endif-%}
                                    {%- endfor -%}
                                </select>
                            </td>
                            <td></td>
                            <td width="33%" align="center">
                                <input class="roundInput" id="filtroValor" name="filtroValor" onchange="filtrarSolicitudes(asignaciones,'filtroCriterio',this.value);"></input>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="3" align="center">
                                <div class="addButton" id="addEmpresaButton" name="addEmpresaButton" onclick="agregarSolicitud(this);" collapsed="true">
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>


                <!--********************************************************-->

                <div class="listadoItems" id="listadoEmpresa" name="listadoEmpresas">
                    {% include 'addEmpresas.html' %}
                    {%- for empresa in listaEmpresas|sort(attribute='nombre') %}
                        <form id="formaSolicitud_{{empresa.id}}">
                            <div class="solicitudItem" id={{empresa.id}} onclick="expandirSolicitud(this);" collapsed="true">
                                <table border="0px" spacing=0 height="100%" width="100%" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td class="lightLabel"
                                            colspan="4"
                                            align="center">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="boldLabel"
                                            colspan="4"
                                            align="center">
                                            &nbsp{{empresa.nombre}}
                                            <br/>
                                            <label class="lightLabel">{{empresa.region}}</label>
                                            <!-- <br/>
                                            <label class="lightLabel">{{empresa.asesor}}</label> -->

                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="lightLabel"
                                            colspan="4"
                                            align="center">
                                        </td>
                                    </tr>
                                </table>
                            </div> <!-- FINALIZA <div class="solicitudItem"> -->



                            <!--********************************************************-->
                            <div class="detalleSolicitudItem" id="detalleSolicitud_{{empresa.id}}">
                                <table id="tablaDetalleSolicitud_{{empresa.id}}" border="0px" spacing=0 width="100%" cellpadding="0" cellspacing="0">
                                    {# listaCamposFiltro|pprint #}
                                    {%- for campo in listaCamposFiltro -%}
                                        {%-set campoActual=campo.value-%}
                                        {%-set asesorSolicitud=empresa.asesorNombre-%}
                                        {%-set empresaSolicitud=empresa.clienteEmpresa-%}
                                        {%- if campo.editRenderable=="true" -%}
                                            <tr>
                                                {%- if campo.tipo=="textarea" -%}
                                                    <td colspan="3" class="boldSmallLabel">
                                                       {{campo.label}}
                                                    </td></tr><tr>
                                                {%-else-%}
                                                    <td class="boldSmallLabel" align="right">
                                                    {{campo.label}}
                                                {%-endif-%}

                                                {%- if campo.addToogle == 'false' -%}

                                                    {%- if campo.tipo!="textarea" -%}
                                                        <td colspan="2" style="padding-right:16px; ">
                                                    {%- else -%}
                                                        <td colspan="3">
                                                    {%-endif-%}

                                                        <{{campo.tipo}} id="{{campo.value}}_{{empresa.id}}"  name="{{campo.value}}" class="{{campo.class}}"
                                                        {%- if campoActual == "listaArchivos"-%}
                                                            size="{{campo.size}}"
                                                        {%- endif -%}

                                                        {%- if campo.tipo == "input" -%}
                                                            value="{{empresa[campoActual]}}"
                                                        {%- endif -%}

                                                        {%- if campo.tipo!="textarea" -%}
                                                            style="width:100%;"
                                                        {%- endif -%}

                                                        {%- if campoActual in user.forbidden-%}
                                                            disabled="true"
                                                        {%- endif-%}


                                                        {# {%- if campoActual=="asesorNombre"-%} onchange="listaEmpresasUpdate(this,{{empresa.id}});"{%-endif-%} #}

                                                        {%- if campoActual=="listaArchivos"-%}
                                                              onchange="mostrarArchivo(this,{{empresa.id}});"
                                                        {%- else -%}
                                                              onchange="updateData(this,{{empresa.id}});"
                                                        {%- endif -%}

                                                        {%-if campo.readOnly=="true"-%}
                                                             readonly
                                                        {%- endif -%}

                                                        >

                                                            {%- if campo.tipo=="select"-%}
                                                                 {%- if campoActual=="asesor"-%}
                                                                    <option value="Sin Asignar"></option>
                                                                    {%-for asesor in listaAsesores|sort(attribute='name') -%}
                                                                            <option value="{{asesor.ownerID}}"
                                                                                {%-if asesor.name==empresa.asesor-%}
                                                                                   selected="selected"
                                                                                {%-endif-%}
                                                                            >{{asesor.name}}</option>

                                                                    {%-endfor-%}
                                                                {%- elif campoActual=="clienteEmpresa" -%}
                                                                    {%- for asignacion in listaEmpresas -%}
                                                                       {%- if asignacion.asesor==asesorSolicitud -%}
                                                                            {%- for empresa in asignacion.empresas|sort() -%}
                                                                                <option value="{{empresa}}"
                                                                                    {%-if empresa==empresaSolicitud-%}
                                                                                        selected="selected"
                                                                                    {%-endif-%}
                                                                                >{{empresa}}
                                                                                </option>
                                                                            {%- endfor-%}

                                                                       {%-endif-%}
                                                                    {%-endfor-%}

                                                                {%- elif (campoActual=="empresaPagadora") -%}
                                                                        <option value=""></option>
                                                                    {%- for pagadora in pagadoras|sort() -%}
                                                                        <option value="{{pagadora}}"
                                                                            {%-if pagadora==empresa.empresaPagadora-%}
                                                                                selected="selected"
                                                                            {%-endif-%}
                                                                        >{{pagadora}}</option>

                                                                    {%-endfor-%}

                                                                {%-elif campoActual=="empresaSegmentacionCobranza"-%}

                                                                <option value=""></option>
                                                                    {%- for segmentacion in pagadoras[empresa.empresaPagadora] -%}
                                                                        <option value="{{segmentacion}}"
                                                                            {%-if segmentacion==empresa.empresaSegmentacionCobranza-%}
                                                                                selected="selected"
                                                                            {%-endif-%}
                                                                        >{{segmentacion}}</option>


                                                                    {%-endfor-%}

                                                                {%- elif (campoActual=="listaArchivos") -%}

                                                                    <!-- en lista archivos -->
                                                                    {%- for documento in empresa.documentosLista -%}
                                                                        <option value="{{documento}}">
                                                                            {{documento}}
                                                                        </option>
                                                                    {%- endfor -%}

                                                                {%-else-%}
                                                                    {# PARA TODOS LOS DEMAS CAMPOS QUE TRAEN SU optionsList #}

                                                                    {%- for option in campo.optionsList-%}
                                                                        <option value="{{option}}"
                                                                            {%-if option == empresa[campo.value]-%}
                                                                             selected
                                                                            {%- endif-%}
                                                                        >{{option}}</option>
                                                                    {%- endfor -%}
                                                                {%-endif-%} {# Finaliza if de campoActual #}

                                                            {%- endif-%} {# Finaliza if "select" #}

                                                        </{{campo.tipo}}>
                                                    </td>
                                                {%- elif campo.addToogle == 'true' -%}
                                                    <td>
                                                        <{{campo.tipo}} id="{{campo.value}}_{{empresa.id}}" name="{{campo.value}}" class="{{campo.class}}" readonly value="{{empresa[campoActual]}}"
                                                        ></{{campo.tipo}}>
                                                    </td>
                                                    <td align="right" style="padding-right: 6px; width: 54px;">
                                                        <label class="switch" {%- if campo.value in user.forbidden -%}
                                                                style="display:none;"
                                                        {%-endif-%}>
                                                            <input type="checkbox" id="check_{{campo.value}}_{{empresa.id}}" name="check_{{campo.value}}_{{empresa.id}}"
                                                            onchange="updateDate({{empresa.id}},{{campo.value}}_{{empresa.id}},this);"
                                                            {%-if (empresa[campoActual]!="") and (empresa[campoActual] is defined)-%}
                                                                checked
                                                            {%-endif-%}
                                                            >
                                                            <span class="slider round"></span>
                                                        </label>
                                                    </td>
                                                {%- endif -%}
                                            </tr>
                                        {%- endif -%}
                                   {%- endfor -%}


                                </table>{# FINALIZA <table border="0" id="tablaDetalleSolicitud"> #}

                                <br/>

                                <table  id="tablaAsesoresAsignados_{{empresa.id}}"
                                        border="0px"
                                        spacing=0
                                        width="100%"
                                        cellpadding="0"
                                        cellspacing="0">

                                    <td colspan="2"
                                        align="center"
                                        style="background:#daffb3;">
                                        Asesores
                                    </td>
                                    <tr/>
                                    {%-for usuario in listaAsesores|sort(attribute='name') -%}
                                        {%- if usuario.region==empresa.region-%}
                                            {%- if usuario.userEstatus=="Activo"-%}

                                                <td>
                                                    <input id="usuario_{{usuario.id}}"
                                                           name="id"
                                                           class="roundInput"
                                                           readonly
                                                           value="{{usuario.name}}"
                                                    >
                                                </td>
                                                <td align="right" style="padding-right: 6px; width: 54px;">
                                                    <label class="switch">
                                                        <input type="checkbox"
                                                            id="asesor{{empresa.id}}"
                                                            name="userID_{{usuario.ownerID}}"
                                                            onchange="updateData(this,{{empresa.id}});"
                                                        {%- if empresa.ownerID == usuario.ownerID -%}
                                                        checked
                                                        {%-endif-%}
                                                        {%-if "userID_"+usuario.ownerID in empresa -%}
                                                            {%- set usuarioActual="userID_"+usuario.ownerID -%}

                                                            {%- if empresa[usuarioActual]=="true" -%}
                                                                checked
                                                            {%- endif -%}
                                                        {%- endif -%}
                                                        >
                                                        <span class="slider round"></span>
                                                    </label>
                                                </td>

                                                </tr>

                                            {%- endif -%}
                                        {%- endif -%}
                                   {%- endfor -%}
                                </table>

                            </div> <!-- FINALIZA <div class="detalleSolicitudItem"> -->

                                <!--********************************************************-->

                        </form>


                    {%- endfor -%}
                    {# <div class="solicitudItem" id="espacioFinal"></div> #}
                </div>
            </div>  <!--Finaliza panel de Solicitudes-->


{%- endblock -%}




